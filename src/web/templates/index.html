<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bússola Solar</title>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/3da1a747b2.js" crossorigin="anonymous"></script>
</head>
<body>

    <br>
    <h1>Bússola Solar</h1>
    <hr>

    <form action="index.php" method="POST" onsubmit="return validatePercentage() && checkPrioritize()">

        <section id="opening">
            <h2>Informações Gerais</h2>
            <fieldset id="header">
                <legend class=centralized>Hoje</legend>
                <div>
                    <table style="width: 100%;" class=tableWithSpacing>
                        <tr>
                            <td class=centralized>
                                <label for="inputDate">Data do Registro</label>
                            </td>
                            <td class=centralized>
                                <input type="date" name="inputDate" id="inputDate" style="width: 125px;">
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="inputTime">Horário de Preenchimento</label>
                            </td>
                            <td class=centralized>
                                <input type="time" name="inputTime" id="inputTime" style="width: 110px;">
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="dayHumor">Humor da Manhã</label>
                            </td>
                            <td class=centralized>
                                <div class=centralized>
                                    <input type="radio" name="dayHumor" id="sun"  value="sol">
                                    <i class="fas fa-sun" style="margin-right: 25px;"></i>
                                    <input type="radio" name="dayHumor" id="moon"  value="lua">
                                    <i class="fas fa-moon"></i>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </fieldset>
        </section>
        
        <br><hr><br>

        <section id="stability">
            <h2>Estabilidade</h2>
            <br>
            <fieldset id="treasurer">
                <legend class=centralized>Tesoureiro</legend>
                <div>
                    <table style="width: 100%;" class=tableWithSpacing>
                        <tr>
                            <td class=centralized>
                                <label for="blackBox">Caixinha Preta</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="blackBox"
                                       id="blackBox"
                                       minlength="3"
                                       title="Insert four digits for the Black Box current value"
                                       oninput="blackBoxOutput.value = formatMoney(blackBox.value)"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="blackBoxOutput">R$ __.__</output></div>
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="greenBox">Caixinha Verde</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="greenBox"
                                       id="greenBox"
                                       minlength="3"
                                       title="Insert four digits for the Black Box current value"
                                       oninput="greenBoxOutput.value = formatMoney(greenBox.value)"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="greenBoxOutput">R$ __.__</output></div>
                            </td>
                        </tr>
                    </table>
                </div>
            </fieldset>
        </section>
        
        <br><hr><br>

        <section id="strength">
            <h2>Força</h2>
            <br>
            <fieldset id="cook">
                <legend class=centralized>Cozinheiro</legend>
                <div>
                    <table style="width: 100%;" class=tableWithSpacing>
                        <tr>
                            <td class=centralized>
                                <label for="calories">Calorias de Ontem</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="calories"
                                       id="calories"
                                       title="Insert four digits for the yesterday Calories total value"
                                       oninput="caloriesOutput.value = formatCalories(calories.value)"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="caloriesOutput">_ cal</output></div>
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="totalWeight">Peso Total</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="totalWeight"
                                       id="totalWeight"
                                       minlength="4"
                                       minlength="5"
                                       title="Insert four digits for the Total Weight"
                                       oninput="totalWeightOutput.value = formatWeight(totalWeight.value, 'kg')"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="totalWeightOutput">__.__ kg</output></div>
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="muscleWeight">Massa Magra</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="muscleWeight"
                                       id="muscleWeight"
                                       minlength="4"
                                       minlength="5"
                                       title="Insert four digits for the Muscle Weight"
                                       oninput="muscleWeightOutput.value = formatWeight(muscleWeight.value, 'kg')"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="muscleWeightOutput">__.__ kg</output></div>
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="fatPercentage">Percentual de Gordura</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="fatPercentage"
                                       id="fatPercentage"
                                       minlength="4"
                                       minlength="4"
                                       title="Insert four digits for the Fat Percentage"
                                       oninput="fatPercentageOutput.value = formatWeight(fatPercentage.value, '%')"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="fatPercentageOutput">__.__ %</output></div>
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="basalMetabolism">Percentual de Gordura</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="basalMetabolism"
                                       id="basalMetabolism"
                                       minlength="4"
                                       minlength="4"
                                       title="Insert four digits for the Basal Metabolism"
                                       oninput="basalMetabolismOutput.value = formatCalories(basalMetabolism.value)"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="basalMetabolismOutput">_ cal</output></div>
                            </td>
                        </tr>
                    </table>
                </div>
            </fieldset>
        </section>
        <br><hr><br>

        <section id="devotion">
            <h2>Devoção</h2>
            <br>
            <fieldset id="sentinel">
                <legend class=centralized>Sentinela</legend>
                <div>
                    <table style="width: 100%;" class=tableWithSpacing>
                        <tr>
                            <td class=centralized>
                                <label for="cellphoneTime">Tempo de Tela</label>
                            </td>
                            <td class=centralized>
                                <input type="number"
                                       name="cellphoneTime"
                                       id="cellphoneTime"
                                       minlength="4"
                                       maxlength="4"
                                       title="Insert four digits for the Cellphone Screen Time"
                                       oninput="cellphoneTimeOutput.value = formatTime(cellphoneTime.value)"
                                       style="width: 110px;">
                            </td>
                            <td class=centralized>
                                <div class="formatedOutput"><output id="cellphoneTimeOutput">__h __min</output></div>
                            </td>
                        </tr>
                    </table>
                </div>
                <br>
                <div>
                    <table style="width: 100%;" class=tableWithSpacing>
                        <tr>
                            <td class=centralized>
                                <label for="bedDateTime">Início do Sono</label>
                            </td>
                            <td class=centralized>
                                <input type="datetime-local" name="bedDateTime" id="bedDateTime" style="width: 150px;">
                            </td>
                        </tr>
                        <tr>
                            <td class=centralized>
                                <label for="wakeupDateTime">Fim do Sono</label>
                            </td>
                            <td class=centralized>
                                <input type="datetime-local" name="wakeupDateTime" id="wakeupDateTime" style="width: 150px;">
                            </td>
                        </tr>
                    </table>
                </div>
                <div class=centralized>
                    <p id="timeDifference" placeholder="Aguardando inserção de ambos os dados."></p>
                </div>
                <br>
                <div>
                    <table style="width: 100%;" class="tableWithSpacing">
                        <tr>
                            <td class="centralized">
                                <label for="awakePercentage">Tempo <strong>Acordado</strong></label>
                            </td>
                            <td class="centralized">
                                <output name="awakePercentageOutput" id="awakePercentageOutput">
                                    <strong>10</strong>
                                </output>%
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized" colspan="2">
                                <input type="range" name="awakePercentage" id="awakePercentage" min="0" max="30" value="10" oninput="awakePercentageOutput.value = awakePercentage.value; awakePercentageOutput.style.fontWeight = 'bold'">
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized">
                                <label for="remPercentage">Sono <strong>REM</strong></label>
                            </td>
                            <td class="centralized">
                                <output name="remPercentageOutput" id="remPercentageOutput">
                                    <strong>15</strong>
                                </output>%
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized" colspan="2">
                                <input type="range" name="remPercentage" id="remPercentage" min="0" max="45" value="15" oninput="remPercentageOutput.value = remPercentage.value; remPercentageOutput.style.fontWeight = 'bold'">
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized">
                                <label for="lightPercentage">Tempo <strong>Leve</strong></label>
                            </td>
                            <td class="centralized">
                                <output name="lightPercentageOutput" id="lightPercentageOutput">
                                    <strong>20</strong>
                                </output>%
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized" colspan="2">
                                <input type="range" name="lightPercentage" id="lightPercentage" min="0" max="60" value="20" oninput="lightPercentageOutput.value = lightPercentage.value; lightPercentageOutput.style.fontWeight = 'bold'">
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized">
                                <label for="deepPercentage">Tempo <strong>Profundo</strong></label>
                            </td>
                            <td class="centralized">
                                <output name="deepPercentageOutput" id="deepPercentageOutput">
                                    <strong>10</strong>
                                </output>%
                            </td>
                        </tr>
                        <tr>
                            <td class="centralized" colspan="2">
                                <input type="range" name="deepPercentage" id="deepPercentage" min="0" max="30" value="10" oninput="deepPercentageOutput.value = deepPercentage.value; deepPercentageOutput.style.fontWeight = 'bold'">
                            </td>
                        </tr>
                    </table>
                </div>
            </fieldset>
            <br><br>
            <fieldset id="leader">
                <legend class=centralized>Líder</legend>
                    <table class="priority">
                        <tr>
                            <th>Sabedoria</th>
                            <th>Estabilidade</th>
                            <th>Força</th>
                            <th>Gentileza</th>
                            <th>Devoção</th>
                        </tr>
                        <tr>
                            <td>
                                <select id="sabedoria" name="sabedoria">
                                    <option value="default" selected></option>
                                    <option value="sacrificar">Sacrificar</option>
                                    <option value="manter">Manter</option>
                                    <option value="priorizar">Priorizar</option>
                                </select>
                            </td>
                            <td>
                                <select id="estabilidade" name="estabilidade">
                                    <option value="default" selected></option>
                                    <option value="sacrificar">Sacrificar</option>
                                    <option value="manter">Manter</option>
                                    <option value="priorizar">Priorizar</option>
                                </select>
                            </td>
                            <td>
                                <select id="forca" name="forca">
                                    <option value="default" selected></option>
                                    <option value="sacrificar">Sacrificar</option>
                                    <option value="manter">Manter</option>
                                    <option value="priorizar">Priorizar</option>
                                </select>
                            </td>
                            <td>
                                <select id="gentileza" name="gentileza">
                                    <option value="default" selected></option>
                                    <option value="sacrificar">Sacrificar</option>
                                    <option value="manter">Manter</option>
                                    <option value="priorizar">Priorizar</option>
                                </select>
                            </td>
                            <td>
                                <select id="devocao" name="devocao">
                                    <option value="default" selected></option>
                                    <option value="sacrificar">Sacrificar</option>
                                    <option value="manter">Manter</option>
                                    <option value="priorizar">Priorizar</option>
                                </select>
                            </td>
                        </tr>    
                        <tr>
                            <td>
                                <input type="checkbox" id="navegador" name="navegador" value="navegador" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="navegador">Navegador</label>
                            </td>
                            <td>
                                <input type="checkbox" id="patrocinador" name="patrocinador" value="patrocinador" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="patrocinador">Patrocinador</label>
                            </td>
                            <td>
                                <input type="checkbox" id="vanguarda" name="vanguarda" value="vanguarda" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="vanguarda">Vanguarda</label>
                            </td>
                            <td>
                                <input type="checkbox" id="zelador" name="zelador" value="zelador" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="zelador">Zelador</label>
                            </td>
                            <td>
                                <input type="checkbox" id="especialista" name="especialista" value="especialista" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="especialista">Especialista</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" id="heroi" name="heroi" value="heroi" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="heroi">Herói</label>
                            </td>
                            <td>
                                <input type="checkbox" id="mecenas" name="mecenas" value="mecenas" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="mecenas">Mecenas</label>
                            </td>
                            <td>
                                <input type="checkbox" id="batedor" name="batedor" value="batedor" data-type="h">
                                <!-- <i class="fas fa-ellipsis-h"></i> -->
                                <label for="batedor">Batedor</label>
                            </td>
                            <td>
                                <input type="checkbox" id="coordenador" name="coordenador" value="coordenador" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="coordenador">Coordenador</label>
                            </td>
                            <td>
                                <input type="checkbox" id="sentinela" name="sentinela" value="sentinela" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="sentinela">Sentinela</label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="checkbox" id="alquimista" name="alquimista" value="alquimista" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="alquimista">Alquimista</label>
                            </td>
                            <td>
                                <input type="checkbox" id="tesoureiro" name="tesoureiro" value="tesoureiro" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="tesoureiro">Tesoureiro</label>
                            </td>
                            <td>
                                <input type="checkbox" id="cozinheiro" name="cozinheiro" value="cozinheiro" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="cozinheiro">Cozinheiro</label>
                            </td>
                            <td>
                                <input type="checkbox" id="diplomata" name="diplomata" value="diplomata" data-type="v">
                                <!-- <i class="fas fa-ellipsis-v" style="margin: 5px;"></i> -->
                                <label for="diplomata">Diplomata</label>
                            </td>
                            <td>
                                <input type="checkbox" id="lider" name="lider" value="lider" data-type="c">
                                <!-- <i class="fas fa-th"></i> -->
                                <label for="lider">Líder</label>
                            </td>
                        </tr>
                    </table>
            
                    <table class="selectedList">
                        <tr>
                            <th>Vertical</th>
                            <th>Horizontal</th>
                        </tr>
                        <tr>
                            <td>
                                <ul id="selected-categories-v" class="selected-list"></ul>
                            </td>
                            <td>
                                <ul id="selected-categories-h" class="selected-list"></ul>
                            </td>
                        </tr>
                    </table>
            </fieldset>
        </section>

        <br><hr><br>

        <section id="ending">
            <div class="buttonContainer">
                <table style="width: 100%;" class=tableWithSpacing>
                    <tr>
                        <td class=centralized>
                            <button class="resetButton" id="reset" style="margin-right: 20px;" type="reset">
                                <i class="fas fa-undo"></i>
                                Reset
                            </button>
                        </td>
                        <td class=centralized>
                            <button class="submitButton" id="submit" type="submit">
                                <i class="fas fa-paper-plane"></i>
                                Submit
                            </button>
                        </td>
                </table>
            </div>
        </section>

        <br><br>
        <br><br>
            
    </form>

    <script>

        // Function to calculate the time difference between bed and wakeup time
        const bedDateTimeInput = document.getElementById('bedDateTime');
        const wakeupDateTimeInput = document.getElementById('wakeupDateTime');
        const timeDifferenceOutput = document.getElementById('timeDifference');
        timeDifferenceOutput.textContent = "Aguardando inserção de ambos os dados.";

        bedDateTimeInput.addEventListener('change', calculateTimeDifference);
        wakeupDateTimeInput.addEventListener('change', calculateTimeDifference);

        function calculateTimeDifference() {
            const bedDateTime = bedDateTimeInput.value;
            const wakeupDateTime = wakeupDateTimeInput.value;

            if (bedDateTime && wakeupDateTime) {
                const bedDateTimeObj = new Date(bedDateTime);
                const wakeupDateTimeObj = new Date(wakeupDateTime);

                const timeDifference = wakeupDateTimeObj - bedDateTimeObj;
                const hours = Math.floor(timeDifference / (1000 * 60 * 60));
                const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));

                timeDifferenceOutput.textContent = `Duração do Sono: ${hours}h e ${minutes}min`;
            } else {
                timeDifferenceOutput.textContent = "Aguardando inserção de ambos os dados.";
            }
        }


        // Function to update the selected categories
        function updateSelectedCategories() {
            const selectedVertical   = document.querySelectorAll('input[type="checkbox"][data-type="v"]:checked');
            const selectedHorizontal = document.querySelectorAll('input[type="checkbox"][data-type="h"]:checked');
            const selectedCross      = document.querySelectorAll('input[type="checkbox"][data-type="c"]:checked');
            const listVertical   = document.getElementById('selected-categories-v');
            const listHorizontal = document.getElementById('selected-categories-h');
            listVertical.innerHTML   = '';
            listHorizontal.innerHTML = '';

            selectedVertical.forEach(category => {
                const label = document.querySelector(`label[for="${category.id}"]`).innerText;
                const listItem = document.createElement('li');
                listItem.textContent = label;
                listVertical.appendChild(listItem);
            });

            selectedHorizontal.forEach(category => {
                const label = document.querySelector(`label[for="${category.id}"]`).innerText;
                const listItem = document.createElement('li');
                listItem.textContent = label;
                listHorizontal.appendChild(listItem);
            });

            selectedCross.forEach(category => {
                const label = document.querySelector(`label[for="${category.id}"]`).innerText;
                const listItemVertical   = document.createElement('li');
                const listItemHorizontal = document.createElement('li');
                listItemVertical.textContent   = label;
                listItemHorizontal.textContent = label;
                listVertical.appendChild(listItemVertical);
                listHorizontal.appendChild(listItemHorizontal);
            });
        }

        // Add event listener to checkboxes
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedCategories);
        });

        // Function to check if the user has selected exactly one "Priorizar" option
        function checkPrioritize() {
            var dropdowns = document.querySelectorAll('.priority select');
            var prioritizeCount = 0;

            dropdowns.forEach(function(dropdown) {
                if (dropdown.value === "priorizar") {
                    prioritizeCount++;
                }
            });

            if (prioritizeCount !== 1) {
                alert("You must select 'Priorizar' for exactly one attribute");
                return false;
            }

            return true;
        }


        // Function to validate the percentage of total sleep
        function validatePercentage() {
            var awakePercentage = parseInt(document.getElementById("awakePercentage").value);
            var remPercentage   = parseInt(document.getElementById("remPercentage").value);
            var lightPercentage = parseInt(document.getElementById("lightPercentage").value);
            var deepPercentage  = parseInt(document.getElementById("deepPercentage").value);

            var totalPercentage = awakePercentage + remPercentage + lightPercentage + deepPercentage;
            document.getElementById('totalPercentageDisplay').innerText = "Total Percentage: " + totalPercentage + "%";
            document.getElementById('totalPercentage').innerText = "Total Percentage: " + totalPercentage + "%";
            
            if (totalPercentage !== 100) {
                alert("A soma das porcentagens deve ser igual a 100%");
                return false;
            }

        return true;
        }

        // Function to format the time input
        function formatTime(value) {
            if (value.length < 4 || value.length > 4) {
                var formatedValue = "__h __min";
            }
            else {
                var formatedValue = value.toString().slice(0, -2) + "h " + value.toString().slice(-2)  + "min";
            }
            return formatedValue;
        }

        function formatCalories(value) {
            if (value.length < 1) {
                var formatedValue = "_ cal (Incomplete Format)";
            }
            else {
                var formatedValue = value + " cal";
            }
            return formatedValue;
        }

        function formatMoney(value) {
            if (value.length < 3) {
                var formatedValue = "R$ __.__";
            }
            else {
                var formatedValue = "R$ " + value/100;
            }
            return formatedValue;
        }

        // Function to format the number input for weight and percentage
        function formatWeight(value, type) {
            if (value.length < 3) {
                var formatedValue = "__.__ " + type;
            }
            else if (value.length > 5 && type === 'kg') {
                var formatedValue = "__.__ kg";
            }
            else if (value.length > 4 && type === '%') {
                var formatedValue = "__.__ %";
            }
            else {
                var formatedValue = value/100 + type;
            }
            return formatedValue;
        }

    </script>

</body>
</html>
